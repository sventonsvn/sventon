<%
/*
 * ====================================================================
 * Copyright (c) 2005-2006 Sventon Project. All rights reserved.
 *
 * This software is licensed as described in the file LICENSE, which
 * you should have received as part of this distribution. The terms
 * are also available at http://sventon.berlios.de.
 * If newer versions of this license are posted there, you may use a
 * newer version instead, at your option.
 * ====================================================================
 */
%>
<%@ page import="java.util.*"%>
<%@ include file="/WEB-INF/jspf/sventonbar.jspf"%>
<spring:hasBindErrors name="command"><c:set var="hasErrors" scope="page" value="true"/></spring:hasBindErrors>

<table class="sventonTopTable" border="0">
  <tr>
    <td valign="bottom" colspan="1"><a href="javascript:toggleElementVisibility('latestCommitInfoDiv'); changeHideShowDisplay('latestCommitLink');">[<span id="latestCommitLink"><c:choose><c:when test="${param.showlatestinfo == 'true'}">hide</c:when><c:otherwise>show</c:otherwise></c:choose></span> latest commit info]</a></td>
    <td align="right">
    <form name="gotoForm" method="post" action="goto.svn">
        <table class="sventonRepositoryFunctionsTable" border="0">
          <tr>
            <td>&nbsp;</td>
            <td><span class="exclamationText"><spring:bind path="command.revision">${status.errorMessage}</spring:bind></span></td>
            <td colspan="2"><span class="exclamationText"><spring:bind path="command.path">${status.errorMessage}</spring:bind></span></td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>Go to revision</td><td colspan="2">Go to path</td>
          </tr>
          <tr>
            <td>
              <c:if test="${!isHead}">
                <a href="javascript:setHeadRevision()" title="Click to insert 'HEAD' into revision field">HEAD</a>
              </c:if>
            </td>
            <td><spring:bind path="command.revision"><input id="revisionInput" class="sventonRevision" type="text" name="revision" value="${status.value}"/></spring:bind></td>
            <td><spring:bind path="command.path"><input id="pathInput" class="sventonGoTo" id="goToPath" type="text" name="path" value="${status.value}" /></spring:bind></td>
            <td><input type="submit" class="btn" value="go!"/></td>
          </tr>
        </table>
      </form>
    </td>
  </tr>
  <tr>
    <td style="white-space: nowrap;" colspan="2">
      <c:if test="${!empty latestCommitInfo}">
        <div id="latestCommitInfoDiv" ${param.showlatestinfo == null || param.showlatestinfo == 'false' ? 'style="display:none"' : ''}" >
          <ui:revisionInfo details="${latestCommitInfo}" keepVisible="true" linkToHead="true" />
        </div>
      </c:if>
    </td>
  </tr>
  <c:set var="command" value="${command}"/>
  <jsp:useBean id="command" type="de.berlios.sventon.command.SVNBaseCommand" />
  <tr>
    <td class="sventonHeadlines" colspan="2">
    <c:choose>
      <c:when test="${!empty numrevision}">
          Rev: ${command.revision} (${numrevision})
      </c:when>
      <c:otherwise>
          Rev: <a class="exclamationText" href="revinfo.svn?revision=${command.revision}">${command.revision}</a>
      </c:otherwise>
    </c:choose>
     - <a href="repobrowser.svn?path=/&revision=${command.revision}">
      ${url} </a> /
      <c:forTokens items="${command.pathNoLeaf}" delims="/" var="pathSegment">
        <c:set var="accuPath" scope="page" value="${accuPath}${pathSegment}/"/>
        <c:choose>
          <c:when test="${hasErrors}">
            ${pathSegment}
          </c:when>
          <c:otherwise>
          <c:url value="repobrowser.svn" var="pathUrl">
            <c:param name="path" value="/${accuPath}" />
            <c:param name="revision" value="${command.revision}" />
          </c:url>
          <a href="${pathUrl}">${pathSegment}</a>
      </c:otherwise>
        </c:choose>
         /
      </c:forTokens>
      ${command.target}
    </td>
  </tr>
</table>

<spring:hasBindErrors name="command">
  <table class="sventonSpringErrorMessageTable" border="0">
    <tr><td><span class="exclamationText"><spring:message code="${errors.globalError.code}" text="${errors.globalError.defaultMessage}"/></span></td></tr>
  </table>
</spring:hasBindErrors>
